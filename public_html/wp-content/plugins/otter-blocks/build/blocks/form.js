!function(){"use strict";const e=(e,o,s)=>{const r=e?.id,i={},{formFieldsData:n,elemsWithError:l}=(e=>{const t=[],o=[{label:window?.themeisleGutenbergForm?.messages["form-submission"]||"Form submission from",value:window.location.href}],s=e?.querySelectorAll(".otter-form__container .wp-block-themeisle-blocks-form-input"),r=e?.querySelectorAll(".otter-form__container .wp-block-themeisle-blocks-form-textarea");return[...s,...r]?.forEach((e=>{const s=e.querySelector(".otter-form-input-label__label, .otter-form-textarea-label__label")?.innerHTML,r=e.querySelector(".otter-form-input, .otter-form-textarea-input"),i=e.querySelector('.otter-form-input[type="checkbox"]')?.checked;r?.hasAttribute("required")&&!r?.checkValidity()&&t.push(r),s&&r?.value&&o.push({label:s,value:r?.value,type:r?.type,checked:i})})),{formFieldsData:o,elemsWithError:t}})(e),a=2>n?.length,c=function(e){const t=`.protection #${e.id||""}_nonce_field`;return e.querySelector(t)?.value}(e),d=e?.classList?.contains("has-captcha"),m=r&&window.themeisleGutenberg?.tokens?.[r]?.token,h=document.createElement("span");if(h.classList.add("spinner"),o.appendChild(h),a)return o.disabled=!1,void o.removeChild(h);if(l.forEach((e=>{e?.reportValidity()})),d&&!m){const e=window.hasOwnProperty("grecaptcha")?"check-captcha":"captcha-not-loaded";s.pullMsg(e,"error").show()}if(0<l.length||d&&!m)o.disabled=!1,o.removeChild(h);else{i.formInputsData=n,m&&(i.token=window.themeisleGutenberg?.tokens?.[r].token),""!==e?.dataset?.emailSubject&&(i.emailSubject=e?.dataset?.emailSubject),e?.dataset?.optionName&&(i.formOption=e?.dataset?.optionName),e?.id&&(i.formId=e?.id),c&&(i.nonceValue=c),i.postUrl=window.location.href,e.classList.contains("can-submit-and-subscribe")&&(i.action="submit-subscribe",i.consent=e.querySelector(".otter-form-consent input")?.checked||!1);const l=(window?.themeisleGutenbergForm?.root||window.location.origin+"/wp-json/")+"otter/v1/form/frontend";fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json, */*;q=0.1","X-WP-Nonce":window?.themeisleGutenbergForm?.nonce},credentials:"include",body:JSON.stringify({handler:"submit",payload:i})}).then((e=>e.json())).then((i=>{const n=i;if("0"===n?.code||"1"===n?.code||n?.success){const o=n?.submitMessage?n.submitMessage:"Success";s.setMsg(o).show(),t(e),setTimeout((()=>{if(0<n?.redirectLink?.length){let e=document.createElement("a");e.target="_blank",e.href=n.redirectLink,e.click()}}),1e3)}else{let e="";0<n?.displayError?.length?(e=n?.displayError,s.setMsg(e,"error").show()):s.setMsg(n?.reasons?.join(""),"error").show(),console.error(`(${n?.code}) ${n?.reasons?.join("")}`)}window.themeisleGutenberg?.tokens?.[r].reset&&window.themeisleGutenberg?.tokens?.[r].reset(),o.disabled=!1,o.removeChild(h)}))?.catch((e=>{console.error(e),s.pullMsg("try-again","error").show(),window.themeisleGutenberg?.tokens?.[r].reset&&window.themeisleGutenberg?.tokens?.[r].reset(),o.disabled=!1,o.removeChild(h)}))}},t=e=>{const t=e?.querySelectorAll(".otter-form__container .wp-block-themeisle-blocks-form-input"),o=e?.querySelectorAll(".otter-form__container .wp-block-themeisle-blocks-form-textarea");[...t,...o]?.forEach((e=>{const t=e.querySelector(".otter-form-input, .otter-form-textarea-input");t?.value&&(t.value=null)}))};var o;o=()=>{const t=document.querySelectorAll(".wp-block-themeisle-blocks-form");(e=>{if(!window.hasOwnProperty("grecaptcha")&&window?.themeisleGutenbergForm?.reRecaptchaSitekey){const t=document.createElement("script");t.id="recaptcha",document.body.appendChild(t),t.addEventListener("load",(()=>{const t=setInterval((()=>{window.hasOwnProperty("grecaptcha")&&window.grecaptcha.hasOwnProperty("render")&&(e.forEach((e=>{e?.classList?.contains("has-captcha")&&(e=>{if(!window.hasOwnProperty("grecaptcha"))return;const{id:t}=e,o=document.createElement("div"),s=e.querySelector(".otter-form__container");s?.insertBefore(o,s.lastChild);const r=window.grecaptcha?.render(o,{sitekey:window?.themeisleGutenbergForm?.reRecaptchaSitekey,callback:e=>{window.themeisleGutenberg||(window.themeisleGutenberg={}),window.themeisleGutenberg?.tokens||(window.themeisleGutenberg.tokens={}),window.themeisleGutenberg.tokens[t]={token:e,reset:()=>window.grecaptcha?.reset(r)}},"expired-callback":()=>{window.themeisleGutenberg?.tokens||(window.themeisleGutenberg={},window.themeisleGutenberg.tokens={}),window.themeisleGutenberg.tokens[t]={token:null,reset:()=>null}}})})(e)})),clearInterval(t))}),200)})),t.src=window?.themeisleGutenbergForm?.reRecaptchaAPIURL}})(t),t.forEach((t=>{t.classList.contains("can-submit-and-subscribe")&&(e=>{const t=e.querySelector(".otter-form__container"),o=e.querySelector(".wp-block-button"),s=document.createElement("div");s.classList.add("otter-form-consent"),t.insertBefore(s,o);const r=document.createElement("input");r.type="checkbox",r.name="o-consent",r.id="o-consent";const i=document.createElement("label");i.innerHTML=window?.themeisleGutenbergForm?.messages?.privacy||"I have read and agreed the privacy statement.",i.htmlFor="o-consent",s.appendChild(r),s.appendChild(i)})(t);const o=t.querySelector("button"),s=new class{constructor(e){this.form=e,this.anchor=e.querySelector(".wp-block-button"),this.anchor?.classList.add("has-submit-msg"),this.msgElem=document.createElement("div"),this.msgElem.classList.add("o-form-server-response"),this.anchor.appendChild(this.msgElem),this.isVisible=!1,this.visibilityTimeout=void 0,this.visibilityDuration=12e3}toggle(e){this.isVisible=void 0!==e?e:!this.isVisible,this.msgElem.style.display=this.isVisible?"block":"none"}pullMsg(e,t){return this.setMsg(window?.themeisleGutenbergForm?.messages[e]||"Messages are missing!",t)}setMsg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";switch(this.msgElem.innerHTML=e,this.clean(),t){case"error":this.msgElem.classList.toggle("o-error",!0);break;case"warning":this.msgElem.classList.toggle("o-warning",!0);break;default:this.msgElem.classList.toggle("o-success",!0)}return this}show(e){clearTimeout(this.visibilityTimeout),this.toggle(!0),this.visibilityTimeout=setTimeout((()=>{this.toggle(!1)}),e||this.visibilityDuration)}clean(){this.msgElem.classList.toggle("o-error",!1),this.msgElem.classList.toggle("o-warning",!1),this.msgElem.classList.toggle("o-success",!1)}}(t);t.querySelector('button[type="submit"]')?t?.addEventListener("submit",(r=>{r.preventDefault(),o.disabled||(o.disabled=!0,e(t,o,s))}),!1):o?.addEventListener("click",(r=>{r.preventDefault(),o.disabled||(o.disabled=!0,e(t,o,s))}),!1)}))},"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",o):o())}();